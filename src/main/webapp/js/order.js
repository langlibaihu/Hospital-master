/*! 2016 Baidu Inc. All Rights Reserved */
define("order",["hasOnlinePayment","js/ajax","js/validate","js/timer","js/loading"],function(){function e(e){var t=[];if(t.push('<div class="info-pic"><img src="'+e.avatar+'"></div>'),t.push('<div class="infos">'),t.push('<div class="info-title"><div>'+e.name+"</div>"),1==e.isVerify)t.push("<i></i><span>百度认证医生</span>");t.push("</div>"),t.push('<p class="info-job"><span>'+e.medTitle+"</span>"+e.eduTitle+"</p>"),t.push('<p class="info-hospittal"><span>'+e.hospitalName+"</span>"+e.departName+"</p>"),t.push('<p class="info-pos"><span>医院地址：</span>'+e.position+"</p>"),t.push("</div>");for(var n=e.appointmentTime,i=0;i<n.length;i++)if(exports.treatTime==n[i].date){exports.day=n[i].day;var r=1==exports.treatInterval?"上午":2==exports.treatInterval?"下午":3==exports.treatInterval?"晚上":"";t.push('<div class="info-time"><span>就诊时间：</span>'+exports.treatTime+"("+exports.day+")"+r+"</div>");break}$(".doctor-info").html(t.join(""))}function t(){if(exports.submitTag)if(exports.submitTag=!1,!n())l("#submit-order",t,!1),exports.submitTag=!0;else{for(var e=require("common/js/ajax"),i=[],r=0;r<exports.img.length;r++)if(exports.img[r]&&exports.img[r].flag)i.push(exports.img[r].smallImg+"|"+exports.img[r].bigImg);if(0==exports.status){var a=localStorage.getItem("isPopLogin"),o=localStorage.getItem("isPopForm");if(a||o)localStorage.removeItem("isPopLogin");if(void 0==exports.visitType)exports.visitType=0;return exports.pics=i,exports.submitTag=!0,c(exports),void localStorage.setItem("isPopForm",!0)}var s={};if(1==exports.hasOnlinePayment){var u=$('input[name="pay-type"]:checked').attr("id");if("pay-type-1"==u)s.payType=1;else if("pay-type-2"==u)s.payType=2;else location.reload()}if(exports.siteFrom)s.siteFrom=exports.siteFrom;if("hdf"==exports.siteFrom)s.province=exports.cityList[exports.currentSelectProvinceIndex].name,s.city=exports.cityList[exports.currentSelectProvinceIndex].children[exports.currentSelectCityIndex].name,s.isTreated=$("#treat-radio")[0].checked?1:0;else if("yizt"==exports.siteFrom&&0==exports.isShowPayType){var d=$(".tr_payType input[name=yizt]:checked").data("value");if(!d)location.reload();else s.yiztCardType=d;if(1==d)s.yiztCardNum=function(){var e=$("#pay-insurance-card").val();if(e.indexOf("请正确")>=0||""==e)e="",location.reload();return e}()}else if("zyw"==exports.siteFrom){var f=$('#tr-treated-redio input[name="treated"]');if(1==exports.isShowTreatedZyw)if(f.eq(0).is(":checked"))s.zywIsTreated=1;else if(f.eq(1).is(":checked"))s.zywIsTreated=0;else return void window.location.reload();if(0==exports.isShowPayType){var p=$('.tr_payType input[name="zyw"]:checked').data("value");if(!p)return void window.location.reload();else s.zywCardType=p;if(1==p)s.zywCardNum=function(){var e=$("#pay-insurance-card").val();if(e.indexOf("请正确")>=0||""==e)return e="",void window.location.reload();else return e}();else if(2==p){if(2==exports.isShowTreatedZyw||s.zywIsTreated)s.zywCardNum=function(){var e=$("#pay-treat-card").val();if(e.indexOf("请正确")>=0||""==e)return e="",void window.location.reload();else return e}();else if(0==s.zywIsTreated)s.zywCardNum=function(){var e=$("#pay-treat-card").val();if(e.indexOf("请正确")>=0||""==e)e="";return e}()}else return void window.location.reload()}}if(1==exports.isShowTreated)s.isShowTreated=$("#tr-treated-redio input[name=treated]:checked").data("value");if(exports.needMedicalCard&&0!=exports.needMedicalCard){var h=$(".tr_card input[name=zjol]:checked").attr("data-value");if(!h)location.reload();else s.zjolCardType=h;s.zjolCardNum=function(){var e=$("#insurance-card").val();if(e.indexOf("请输入")>=0)e="";return e}()}if(exports.needContactAddress&&0!=exports.needContactAddress)s.zjolAddress=function(){var e=$("#contact-address").val();if(e.indexOf("请输入")>=0)e="";return e}();var m=""+exports.api+"/pc/appointment/add";if(s.pics=i.join(",")||exports.pics,s.visitType=exports.visitType||0,exports.needCard>0)s.visitCard=function(){var e=$("#patient-id-card").val();if(e.indexOf("就诊")>=0)e="";return e}();if(1==exports.needCardPassword)s.visitCardPassword=exports.rsa.encryptRsaKey($("#patient-id-card-password").val()).replace(/[\n\r]/g,"");if(1==exports.displayDisDesc)if("hdf"==exports.siteFrom)s.diseaseDesc=($("#disease-name").val()+";"+$("#condition").val()).substr(0,300);else s.diseaseDesc=$("#condition").val();if(s.doctorId=exports.doctorId,s.term="pc",s.treatTime=exports.treatTime,s.treatInterval=exports.treatInterval,s.phone=$("#phone-number").val(),void 0!=exports.nowPatientList[exports.nowSelectedPatient])s.patientId=exports.nowPatientList[exports.nowSelectedPatient].id;else s.name=$("#patient-name").val(),s.identification=$("#id-card").val();if(exports.sharingTime)$.extend(s,exports.sharingTime.passBackData);if(1==s.payType||2==exports.hasOnlinePayment){var g=require("common/js/timer"),v=new g({content:'<span class="loading-bg">正在为您锁号...</span>'});v.init()}e({url:m,type:"POST",async:!1,data:s,success:function(e){if(1==s.payType||2==exports.hasOnlinePayment?$(".timer-popup").remove():"",0==e.status)if(e.data.sucUrl)if(1==s.payType||2==exports.hasOnlinePayment){var t=require("common/js/timer"),n=new t({content:'<span class="loading-bg">正在为您跳转支付页面...</span>'});n.init(),setTimeout(function(){location.href=e.data.sucUrl},1e3)}else location.href=e.data.sucUrl;else{var i=e.data.reason||e.statusInfo;$(".popwin-info p").html(i);var r=e.data.errorUrl||"";$(".popwin-info input").val(e.data.buttonText).data("url",r),$(".popwin-info").show()}else if(-108==e.status)$("#patient-list .card-person-suc").removeClass("card-person-suc").addClass("card-nameId-err");else if(e.statusInfo)$(".popwin-info p").html(e.statusInfo),$(".popwin-info input").val("返回").data("url",""),$(".popwin-info").show();exports.submitTag=!0},error:function(){exports.submitTag=!0}})}else;}function n(){var e=!0;if(0==exports.hasOnlinePayment||2==exports.hasOnlinePayment);else if(2!=$('input[name="pay-type"]').length)return location.reload(),!1;if(1==exports.status&&0!=exports.nowPatientList.length&&-1==exports.nowSelectedPatient)return!1;if(0==exports.status||0==exports.nowPatientList.length){var t=p();e=e&&t;var n=h();e=e&&n}var i=m();if(e=e&&i,0<exports.needCard){var r=x();e=e&&r}if(0<exports.needMedicalCard){var r=g();e=e&&r}if(0<exports.needContactAddress){var r=v();e=e&&r}if("zyw"==exports.siteFrom){var a=2==exports.isShowTreatedZyw?2:"";if(1==exports.isShowTreatedZyw){var o=$('#tr-treated-redio input[name="treated"]');if(2!=o.length)window.location.reload();if(!o.is(":checked"))$("#tr-treated-redio").find(".wrong").show(),e=!1;else if(o.eq(0).is(":checked"))a=1;else if(o.eq(1).is(":checked"))a=0;else a=-1}var s=$('.tr_payType input[name="zyw"]');if(s.eq(0).is(":checked")){var l=y();e=e&&l}else if(s.eq(1).is(":checked"))e=b(a)&&e;else $(".tr_payType").find(".wrong").show(),e=!1}if("yizt"==exports.siteFrom&&0==exports.isShowPayType){var c=$(".tr_payType input[name=yizt]:checked").data("value");if(1==c){var l=y();e=e&&l}else if(!c)$(".tr_payType").find(".wrong").show(),e=!1}if(1==exports.isShowTreated){var o=$('#tr-treated-redio input[name="treated"]');if(2!=o.length)window.location.reload();if(!o.is(":checked"))$("#tr-treated-redio").find(".wrong").show(),e=!1}if(1==exports.needCardPassword){var u=w();e=e&&u}if(1==exports.displayDisDesc){var d=k();e=e&&d}if(e=e&&$("#agreement").is(":checked"),0==$("#agreement").is(":checked"))$(".widget-wrong").show();else $(".widget-wrong").hide();if("hdf"==exports.siteFrom){if(e=e&&!(-1==exports.currentSelectCityIndex||-1==exports.currentSelectProvinceIndex),-1==exports.currentSelectCityIndex||-1==exports.currentSelectProvinceIndex)$(".city-wrong").show();e=C()&&e}return e}function r(e,t,n,i){if(t)e.parent().find(".right").show(),e.parent().find(".wrong").hide();else e.parent().find(".right").hide(),n.html(i),e.parent().find(".wrong").show()}function a(){$("#patient-list li").not(":last").detach(),T.getPatientList(function(e){var t=e.data;if(exports.nowPatientList=t,void 0!=t[0])exports.nowSelectedPatient=0;for(var n=0;n<t.length;n++){var i=$('<li class="card-person-err"><span></span></li>');if(0==n)var i=$('<li class="card-person-suc"><span></span></li>');var r=$("<div></div>");if(r.append("<p>"+t[n].name+"</p>"),r.append("<p>"+t[n].identification+"</p>"),i.append(r),$('<i class="right instant-state fa fa-check-circle"></i><i class="edit instant-state"></i><p class="nameIdError"><i class="fa fa-times-circle"></i>姓名与身份证不匹配</p>').appendTo(i),function(e){i.on("click",function(t){var n=$(this).attr("class");if("card-nameId-err"!=n){var i=$(this);i.parent().find(".card-person-suc").removeClass().addClass("card-person-err"),i.parent().find(".card-nameId-err").removeClass().addClass("card-person-err"),i.removeClass("card-person-err").addClass("card-person-suc"),exports.nowSelectedPatient=e}})}(n),n>=3)i.hide();$(".card-person-add").before(i)}if(0==t.length)$("#patient-name").show(),$("#widget-card").remove(),$("#id-card-tr").show().find("#id-card").show();else $("#patient-name").remove(),$("#id-card-tr").remove(),$("#widget-input-name").remove();if(exports.nowPatientList.length<=3)$("#arrow-down").hide();else $("#arrow-down").show();$("#arrow-up").hide()})}function o(e){for(var t=e.selectedAppointTimeIndex,e=e.appointTime,n=6,i=$("#order-time-list"),r=[],a=e.length,o="block",s=0;a>s;s++){if(s>=n)o="none";var l='<li style="display:'+o+'"><div><span class="date white" key='+e[s].date.code+">"+e[s].date.text+'</span><span class="white">'+e[s].day+'</span><span class="interval" key='+e[s].interval.code+">"+e[s].interval.text+'</span></div><i class="actived_ico"></i></li>';r.push(l)}if(i.append(r.join("")),i.find("li").eq(t).addClass("actived").find("div").css("border-color","#ff7705"),exports.treatTime=e[t].date.code,exports.treatInterval=e[t].interval.code,n>=a)$(".arrowico").hide();i.find("li").on("click",function(){i.find("li").removeClass("actived").find("div").css("border-color","#ffffff"),$(this).addClass("actived").find("div").css("border-color","#ff7705"),exports.treatTime=$(this).find(".date").attr("key"),exports.treatInterval=$(this).find(".interval").attr("key")}),$(".order-wrap .arrowico").on("click",function(){var e=$(this).find("i").hasClass("fa-sort-desc");if(e)i.find("li").show(),$(this).find("span").text("收起"),$(this).find("i").removeClass("fa-sort-desc").addClass("fa-sort-asc");else{$(this).find("span").text("展开"),$(this).find("i").removeClass("fa-sort-asc").addClass("fa-sort-desc");for(var t=i.find("li"),r=t.length,a=0;r>a;a++)if(a>=n)$(t[a]).hide()}}),i.find("li").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})}function s(e,t){if(e){for(var n=0,i=$("#order-time-list"),r=[],a=e.length,o="block",s=0;a>s;s++){if(s>=t)o="none";var l='<li style="display:'+o+'"><div><span class="date white" key='+e[s].text+">"+e[s].text+'</span></div><i class="actived_ico fa fa-check-circle right" style="display:none;"></i></li>';r.push(l)}if(i.append(r.join("")),i.find("li").eq(n).addClass("actived").find("div").css("border-color","#ff7705"),exports.sharingTime=e[n],t>=a)$(".arrowico").remove();i.find("li").on("click",function(){i.find("li").removeClass("actived").find("div").css("border-color","#ffffff"),$(this).addClass("actived").find("div").css("border-color","#ff7705"),exports.sharingTime=e[$("#order-time-list li").index($(this))]}),$(".order-wrap .arrowico").on("click",function(){var e=$(this).find("i").hasClass("fa-sort-desc");if(e)i.find("li").show(),$(this).find("span").text("收起"),$(this).find("i").removeClass("fa-sort-desc").addClass("fa-sort-asc");else{$(this).find("span").text("展开"),$(this).find("i").removeClass("fa-sort-asc").addClass("fa-sort-desc");for(var n=i.find("li"),r=n.length,a=0;r>a;a++)if(a>=t)$(n[a]).hide()}}),i.find("li").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")}),$("#sharing-times-tr").show()}}function l(e,t,n){}function c(e){u(e),showLoginPop(d)}function u(e){return}function d(){exports.submitTag=!1;for(var e=""+exports.api+"/pc/appointment/add",t=[],n=0;n<exports.img.length;n++)if(void 0!=exports.img[n].smallImg&&void 0!=exports.img[n].bigImg)t.push(exports.img[n].smallImg+"|"+exports.img[n].bigImg);if(ajaxData={},1==exports.hasOnlinePayment){var i=$('input[name="pay-type"]:checked').attr("id");if("pay-type-1"==i)ajaxData.payType=1;else if("pay-type-2"==i)ajaxData.payType=2;else location.reload()}if(exports.siteFrom)ajaxData.siteFrom=exports.siteFrom;if("hdf"==exports.siteFrom)ajaxData.province=exports.cityList[exports.currentSelectProvinceIndex].name,ajaxData.city=exports.cityList[exports.currentSelectProvinceIndex].children[exports.currentSelectCityIndex].name,ajaxData.isTreated=$("#treat-radio")[0].checked?1:0;else if("yizt"==exports.siteFrom&&0==exports.isShowPayType){var r=$(".tr_payType input[name=yizt]:checked").data("value");if(!r)location.reload();else ajaxData.yiztCardType=r;if(1==r)ajaxData.yiztCardNum=function(){var e=$("#pay-insurance-card").val();if(e.indexOf("请输入")>=0||""==e)e="",window.reload();return e}()}else if("zyw"==exports.siteFrom){var a=$('#tr-treated-redio input[name="treated"]');if(1==exports.isShowTreatedZyw)if(a.eq(0).is(":checked"))ajaxData.zywIsTreated=1;else if(a.eq(1).is(":checked"))ajaxData.zywIsTreated=0;else return void window.location.reload();if(0==exports.isShowPayType){var o=$('.tr_payType input[name="zyw"]:checked').data("value");if(!o)return void window.location.reload();else ajaxData.zywCardType=o;if(1==o)ajaxData.zywCardNum=function(){var e=$("#pay-insurance-card").val();if(e.indexOf("请正确")>=0||""==e)return e="",void window.location.reload();else return e}();else if(2==o){if(2==exports.isShowTreatedZyw||ajaxData.zywIsTreated)ajaxData.zywCardNum=function(){var e=$("#pay-treat-card").val();if(e.indexOf("请正确")>=0||""==e)return e="",void window.location.reload();else return e}();else if(0==ajaxData.zywIsTreated)ajaxData.zywCardNum=function(){var e=$("#pay-treat-card").val();if(e.indexOf("请正确")>=0||""==e)e="";return e}()}else return void window.location.reload()}}if(1==exports.isShowTreated)ajaxData.isShowTreated=$("#tr-treated-redio input[name=treated]:checked").data("value");if(exports.needMedicalCard&&0!=exports.needMedicalCard){var s=$(".tr_card input[name=zjol]:checked").attr("data-value");if(!s)location.reload();else ajaxData.zjolCardType=s;ajaxData.zjolCardNum=function(){var e=$("#insurance-card").val();if(e.indexOf("请输入")>=0)e="";return e}()}if(exports.needContactAddress&&0!=exports.needContactAddress)ajaxData.zjolAddress=function(){var e=$("#contact-address").val();if(e.indexOf("请输入")>=0)e="";return e}();if(ajaxData.pics=t.join(",")||"",ajaxData.visitType=exports.visitType||0,exports.needCard>0)ajaxData.visitCard=function(){var e=$("#patient-id-card").val();if(e.indexOf("就诊")>=0)e="";return e}();if(1==exports.needCardPassword)ajaxData.visitCardPassword=exports.rsa.encryptRsaKey($("#patient-id-card-password").val()).replace(/[\n\r]/g,"");if(1==exports.displayDisDesc)if("hdf"==exports.siteFrom)ajaxData.diseaseDesc=($("#disease-name").val()+";"+$("#condition").val()).substr(0,300);else ajaxData.diseaseDesc=$("#condition").val();if(ajaxData.doctorId=exports.doctorId,ajaxData.treatTime=exports.treatTime,ajaxData.treatInterval=exports.treatInterval,ajaxData.name=$("#patient-name").val(),ajaxData.phone=$("#phone-number").val(),ajaxData.identification=$("#id-card").val(),exports.sharingTime)$.extend(ajaxData,exports.sharingTime.passBackData);if(1==ajaxData.payType||2==exports.hasOnlinePayment){var l=require("common/js/timer"),c=new l({content:'<span class="loading-bg">正在为您锁号...</span>'});c.init()}var u=require("common/js/ajax");u({url:e,type:"POST",datatype:"json",async:!1,data:ajaxData,success:function(e){if("data"in e&&"sucUrl"in e.data)if(1==ajaxData.payType||2==exports.hasOnlinePayment){var t=require("common/js/timer"),n=new t({content:'<span class="loading-bg">正在为您跳转支付页面...</span>'});n.init(),setTimeout(function(){location.href=e.data.sucUrl},1e3)}else location.href=e.data.sucUrl;else{if(url="","data"in e&&"reason"in e.data)reason=e.data.reason,url=e.data.errorUrl;else reason=e.statusInfo;failUrl=e.data.failBaseUrl+"?type=fail&reason="+reason+"&url="+encodeURIComponent(window.location.href),window.location=failUrl}exports.submitTag=!0},error:function(){exports.submitTag=!0,location.reload()}})}function f(){}function p(){var e=$("#patient-name");if(rightOrWrong=!1,tips="",1==T.isEmptyName(e[0])||void 0==e[0].name)tips="请输入姓名";else if(1==T.isWrongName(e[0]))tips="姓名填写有误";else rightOrWrong=!0;return r(e,rightOrWrong,$("#name-wrong-info"),tips),l("#submit-order",t,rightOrWrong),rightOrWrong}function h(){var e=$("#id-card"),n="",i=!1;if(""==T.stripSpaces(e[0])||void 0==e[0].value)n="请输入身份证号";else if(!T.idCardCheck(e[0].value))n="身份证号填写有误";else i=!0;return r(e,i,$("#idcard-wrong-info"),n),l("#submit-order",t,i),i}function m(){var e=$("#phone-number"),n="",i=!1;if(""==T.stripSpaces(e[0])||void 0==e[0])n="请正确输入手机号";else if(!S.test(e[0].value))n="手机号填写有误";else i=!0;return r(e,i,$("#phone-wrong-info"),n),l("#submit-order",t,i),i}function g(){var e=$("#insurance-card"),n="",i=!1;if(1==exports.needMedicalCard){if(""==T.stripSpaces(e[0])||void 0==e[0]||$("#insurance-card").val().indexOf("就诊")>=0)n="请正确输入医保卡号";else i=!0;r(e,i,$("#insurance-card-info"),n)}else if(2==exports.needMedicalCard)i=!0,r(e,i,$("#insurance-card-info"),n),$("#insurance-card").siblings("span").hide();return l("#submit-order",t,i),i}function v(){var e=$("#contact-address"),n="",i=!1;if(1==exports.needContactAddress){if(""==T.stripSpaces(e[0])||void 0==e[0]||$("#contact-address").val().indexOf("请输入")>=0)n="请正确输入联系地址";else i=!0;r(e,i,$("#contact-address-info"),n)}else if(2==exports.needContactAddress)i=!0,r(e,i,$("#contact-address-info"),n),$("#contact-address").siblings("span").hide();return l("#submit-order",t,i),i}function y(){var e=$("#pay-insurance-card"),n="",i=!1;if(""==T.stripSpaces(e[0])||void 0==e[0]||$("#pay-insurance-card").val().indexOf("请正确")>=0)n="请正确输入医保卡号";else i=!0;return r(e,i,$("#payInsurance-card-info"),n),l("#submit-order",t,i),i}function b(e){var n=$("#pay-treat-card"),i="",a=!1;if(2==e||1==e)if(""==T.stripSpaces(n[0])||void 0==n[0]||n.val().indexOf("请正确")>=0)i="请正确输入就诊卡号";else a=!0;else if(0==e)a=!0;if(2==e||1==e)r(n,a,$("#payInsurance-card-info"),i);else if(0==e)$("#payInsurance-card-info").parent().hide();return l("#submit-order",t,a),a}function x(){var e=$("#patient-id-card"),n="",i=!0,a=e[0].value;if(1==exports.needCard){if(/^[\s]+$/.test(a)||""==a||void 0==a)i=!1,n="请输入就诊卡号";if(a.indexOf("就诊")>=0)i=!1,n="就诊卡号填写有误";r(e,i,$("#patient-idcard-wrong-info"),n)}else if(2==exports.needCard)if(a&&"若有该医院就诊卡，请填写；若无，可到医院办理。"!=a)r(e,i,$("#patient-idcard-wrong-info"),n);else $("#patient-id-card").siblings("span").hide();return l("#submit-order",t,i),i}function w(){var e=$("#patient-id-card-password"),n="",i=!0,a=e.val();if(!a)i=!1,n="请输入就诊卡密码";return r(e,i,$("#patient-idcardpassword-wrong-info"),n),l("#submit-order",t,i),i}function C(){var e=$("#disease-name");if(/^\s*$/.test(e.val())||e.val().length>20)return $("#disease-name-wrong-info").show().prev().hide().next().find(".wrong-info").html("请填写所患疾病名字"),e.val(""),!1;else return $("#disease-name-wrong-info").hide().prev().show(),!0}function k(){var e=$("#condition"),n="",i=!0;if(""==e[0].value||void 0==e[0].value)n="请输入疾病描述",i=!1;if(i)e.parent().parent().find(".widget-instant-right-state").find(".right").show(),e.parent().parent().find(".widget-instant-wrong-state").find(".wrong").hide();else e.parent().parent().find(".widget-instant-right-state").find(".right").hide(),$("#dis-wrong-info").html(n),e.parent().parent().find(".widget-instant-wrong-state").find(".wrong").show();return l("#submit-order",t,i),i}var exports={};exports.img=[],exports.hasOnlinePayment=require("hasOnlinePayment"),exports.submitTag=!0,exports.submitFlag=!0,exports.rsa=function(){var e="93b2b4a59fe63cdc1a65c6e006d2a710de3d8bcfe93cb601f1af2c49946b80dfa1e607195b0ee8969e24544153fc12b84acdfbba53949f0a0d6c6f665dce4c37",t="10001",n=130;return setMaxDigits(n),{encryptRsaKey:function(n){return encryptedString(new RSAKeyPair(t,"",e),n)}}}(),exports.href=function(){var e=$(".footer").data("href");return e}(),exports.api=function(){var e=$(".footer").data("api");return e}(),exports.passUrl=function(){var e=$(".footer").data("passport");return e}(),exports.getDoctorDetail=function(){var t=require("common/js/ajax");t({url:""+this.api+"/pc/doctor/detail",type:"GET",dataType:"json",data:{doctorId:this.doctorId,term:"pc"},success:function(t){this.doctorDetail=t.data,e(t.data)},error:function(){}})};var T=require("order/validate");exports.nowPatientList=[];var S=/^\+?(0|86|17951)?(13[0-9]|15[012356789]|17[0-9]|18[0-9]|14[57])[0-9]{8}$/;return exports.addDomEvent=function(){var e=this;if("hdf"==e.siteFrom){$(".write-list").on("focus",'input[type="text"],textarea',function(){if("请选择"==$("#city-view").html())$(".city-wrong").show()}),$(".dropdown").on("click",function(){if($(".city-list").hide(),$(this).find("i").hasClass("fa-angle-down"))$(this).find("i").attr("class","fa fa-angle-up triangle-icon"),$(this).find(".city-list").show(),$(this).find("div").eq(0).css("z-index","200"),$(this).find(".bgWhite").css("height","34px");else $(this).find(".bgWhite").css("height","33px"),$(this).find("i").attr("class","fa fa-angle-down triangle-icon"),$(this).find("div").eq(0).css("z-index","0")}),$(".dropdown").hover(function(){},function(){$(this).find("i").attr("class","fa fa-angle-down triangle-icon"),$(".city-list").hide(),$(this).find("div").eq(0).css("z-index","0"),$(this).find(".bgWhite").css("height","33px")}),$("#province-list").delegate("li","click",function(){var t=$("#province-list li"),n=t.index($(this));if(this.currentSelectProvinceIndex!=n){var i=[];e.currentSelectProvinceIndex=n,$("#province-view").text(e.cityList[n].name),$("#city-view").text("请选择"),e.currentSelectCityIndex=-1,t.removeClass("currentSelect"),$(this).addClass("currentSelect");var r=e.cityList[n].children.length;for(e.currentSelectProvinceIndex=n;r--;)i.push('<li class="city-item">'+e.cityList[n].children[r].name+"</li>");i.reverse(),$("#city-list").html(i.join("")),$(".city-right").hide()}}),$("#city-list").delegate("li","click",function(){var t=$("#city-list li"),n=t.index($(this));if(this.currentSelectCityIndex!=n)e.currentSelectCityIndex=n,$("#city-view").text(e.cityList[e.currentSelectProvinceIndex].children[n].name),t.removeClass("currentSelect"),$(this).addClass("currentSelect"),$(".city-wrong").hide(),$(".city-right").show()}),$("#city-list, #province-list").delegate("li","mouseenter",function(){$(this).addClass("temporarySelect")}),$("#city-list, #province-list").delegate("li","mouseleave",function(){$(this).removeClass("temporarySelect")});var t=e.cityList.length,n=[],r=[];for(e.currentSelectProvinceIndex=-1,e.currentSelectCityIndex=-1;t--;)if(e.cityList[t].name==e.currentProvName){n.push('<li class="city-item currentSelect">'+e.cityList[t].name+"</li>"),$("#province-view").text(e.cityList[t].name);var o=e.cityList[t].children.length;for(e.currentSelectProvinceIndex=t;o--;)if(e.cityList[t].children[o].name==e.currentCityName)r.push('<li class="city-item currentSelect">'+e.cityList[t].children[o].name+"</li>"),$("#city-view").text(e.cityList[t].children[o].name),e.currentSelectCityIndex=o,$(".city-right").show();else r.push('<li class="city-item">'+e.cityList[t].children[o].name+"</li>");r.reverse(),$("#city-list").html(r.join(""))}else n.push('<li class="city-item">'+e.cityList[t].name+"</li>");n.reverse(),$("#province-list").html(n.join(""))}if($(".back-button").on("click",function(){if(""!=$(this).data("url"))window.location.href=$(this).data("url");else $(".popwin-info").hide()}),$("#patient-list").on("click",".edit",function(){$(".popwin-edit").show();var e=$($(this).siblings("div").find("p")[0]).html(),t=$($(this).siblings("div").find("p")[1]).html();$($(".popwin-edit .card-input").find("input")[0]).val(e),$($(".popwin-edit .card-input").find("input")[1]).val(t),$($(".popwin-edit .card-input").find("input")[0]).attr("data-default",e),$($(".popwin-edit .card-input").find("input")[1]).attr("data-default",t)}),"zjol"==e.siteFrom)exports.insuranceCard="请输入医疗保险卡号",$(".tr_card input[type='radio']").on("click",function(){var e=$(this).parent().index();switch(e){case 0:str="请输入省医保卡号";break;case 1:str="请输入市医保卡号";break;case 2:str="请输入市民卡号";break;case 3:str="请输入农保卡号"}if($("#insurance-card").attr("placeholder",str),$("#insurance-card").data("value",str),T.getInternetExplorerVersion()>=8)!function(){$("#insurance-card").val(str),exports.insuranceCard=str}()});else if("yizt"==e.siteFrom&&0==e.isShowPayType)$(".tr_payType input[type='radio']").on("click",function(){$(this).parent().parent().find(".wrong").remove();var e=$(this).parent().index();if(0==e)$(".payType-input").show();else $(".payType-input").hide();if($("#pay-insurance-card").val("").siblings("span").hide(),T.getInternetExplorerVersion()>=8)!function(){$("#pay-insurance-card").val("请输入医疗保险卡号")}()});else if("zyw"==e.siteFrom&&0==e.isShowPayType)$(".tr_payType input[type='radio']").on("click",function(){$(this).parent().parent().find(".wrong").remove();var e=$(this).parent().index();if(0==e)$(".payType-input").show().find("#pay-insurance-card").show(),$(".payType-input").show().find("#pay-treat-card").hide();else $(".payType-input").show().find("#pay-insurance-card").hide(),$(".payType-input").show().find("#pay-treat-card").show();if($("#pay-insurance-card").val("").siblings("span").hide(),$("#pay-treat-card").val("").siblings("span").hide(),T.getInternetExplorerVersion()>=8)!function(){$("#pay-insurance-card").val("请正确输入医保卡号，否则影响取号就诊").css("color","#ccc"),$("#pay-treat-card").val("请正确输入就诊卡号，否则影响取号就诊").css("color","#ccc")}()});if("zyw"==e.siteFrom&&1==e.isShowTreatedZyw)$('#tr-treated-redio input[name="treated"]').on("click",function(){$(this).off("click").parent().parent().find(".wrong").remove()});if(1==e.isShowTreated)$('#tr-treated-redio input[name="treated"]').on("click",function(){$(this).off("click").parent().parent().find(".wrong").remove()});if($(".fileupload li div .img").on("click",function(){}),$(".fileupload li div .delete").on("click",function(){$(this).parent().find(".img").attr("src",""),$(this).parent().hide(),e.img[$(this).data("index")].flag=!1}),$("#d_pic1").on("click",function(){localStorage.removeItem("pic1_small"),localStorage.removeItem("pic1_big"),delete exports.img[0]}),$("#d_pic2").on("click",function(){localStorage.removeItem("pic2_small"),localStorage.removeItem("pic2_big"),delete exports.img[1]}),$("#d_pic3").on("click",function(){localStorage.removeItem("pic3_small"),localStorage.removeItem("pic3_big"),delete exports.img[2]}),$("#d_pic4").on("click",function(){localStorage.removeItem("pic4_small"),localStorage.removeItem("pic4_big"),delete exports.img[3]}),$("#d_pic5").on("click",function(){localStorage.removeItem("pic5_small"),localStorage.removeItem("pic5_big"),delete exports.img[4]}),$("#file1, #file2, #file3, #file4, #file5").on("change",function(){var t=$(this).attr("id");$.ajaxFileUpload({url:""+e.api+"/pc/common/saveImage",secureuri:!1,fileElementId:$(this).attr("id"),type:"POST",dataType:"json",success:function(n){if(0==n.status)if(0==n.data.status){var i=t;e.img[i.charAt(i.length-1)-1]={},e.img[i.charAt(i.length-1)-1].smallImg=n.data.smallImg,e.img[i.charAt(i.length-1)-1].bigImg=n.data.bigImg,e.img[i.charAt(i.length-1)-1].flag=!0,$($(".fileupload div")[i.charAt(i.length-1)-1]).show(),$($(".img")[i.charAt(i.length-1)-1]).attr("src",n.data.smallImg),exports.img[i.charAt(i.length-1)-1].smallImg=n.data.smallImg,exports.img[i.charAt(i.length-1)-1].bigImg=n.data.bigImg}else{var r=n.data.statusInfo;$(".popwin-info p").html(r),$(".popwin-info input").val("确定").data("url",""),$(".popwin-info").show()}else $(".popwin-info p").html("图片上传失败，请重新尝试"),$(".popwin-info input").val("确定").data("url",""),$(".popwin-info").show()},error:function(e){$(".popwin-info p").html("图片上传失败，请重新尝试，图片最大为3.5M"),$(".popwin-info input").val("确定").data("url",""),$(".popwin-info").show()}})}),0==e.status||0==e.nowPatientList.length)$("#patient-name").on("blur",function(){p()}),T.addInputEventListener("#patient-name",function(){var e=this.value;if(e.length>15)this.value=e.substr(0,15)}),$("#id-card").on("blur",function(){h()}),T.addInputEventListener("#id-card",function(){var e=this.value;if(!(e.length<18&&/^[0-9]*$/.test(e)))if(e.length<18)this.value=e.replace(/[^0-9]/g,"");else if(e.length>18)this.value=e.substr(0,18);else this.value=e.replace(/[^0-9x]$/i,"")});else T.addInputEventListener("#popwin-patient-name",function(){var e=this.value;if(e.length>15)this.value=e.substr(0,15)}),T.addInputEventListener("#popwin-id-card",function(){var e=this.value;if(!(e.length<18&&/^[0-9]*$/.test(e)))if(e.length<18)this.value=e.replace(/[^0-9]/g,"");else if(e.length>18)this.value=e.substr(0,18);else this.value=e.replace(/[^0-9x]$/i,"")});if($("#arrow-up").on("click",function(){var e=$("#patient-list li:eq(1)").position().top;$("#patient-list li").filter(function(t){if($(this).position().top>e)$(this).hide()}).hide(),$("#arrow-down").show(),$(".card-person-add").show(),$(this).hide()}),$("#arrow-down").on("click",function(){$("#patient-list li").show(),$("#arrow-up").show(),$(this).hide()}),$("#phone-number").on("blur",function(){m()}),$("#phone-number").keypress(function(e){var t=[],n=e.which;for(i=48;i<58;i++)t.push(i);if(!Array.prototype.indexOf)Array.prototype.indexOf=function(e,t){for(var n=t||0,i=this.length;i>n;n++)if(this[n]===e)return n;return-1};if(!(t.indexOf(n)>=0||8==n||0==n))e.preventDefault()}),T.getInternetExplorerVersion()>=8)!function(){var e=$("#patient-id-card").data("value"),t=$("#insurance-card").data("value"),n=$("#contact-address").data("value"),i=$("#pay-insurance-card").data("value"),r=$("#pay-treat-card").data("value");$("#patient-id-card").val(e).css("color","#ccc"),$("#patient-id-card").on("focus",function(){if($(this).val()==e)$(this).val("").css("color","#000")}),$("#patient-id-card").on("blur",function(){if(""==$(this).val())$(this).val(e).css("color","#ccc")}),$("#insurance-card").val(t).css("color","#ccc"),$("#insurance-card").on("focus",function(){if($(this).val().indexOf("请输入")>=0)$(this).val("").css("color","#000")}),$("#insurance-card").on("blur",function(){if(""==$(this).val())$(this).val(exports.insuranceCard).css("color","#ccc")}),$("#contact-address").val(n).css("color","#ccc"),$("#contact-address").on("focus",function(){if($(this).val()==n)$(this).val("").css("color","#000")}),$("#contact-address").on("blur",function(){if(""==$(this).val())$(this).val(n).css("color","#ccc")}),$("#pay-insurance-card").val(i).css("color","#ccc"),$("#pay-insurance-card").on("focus",function(){if($(this).val().indexOf(i.substr(0,2))>=0)$(this).val("").css("color","#000");else $(this).css("color","#000")}),$("#pay-insurance-card").on("blur",function(){if(""==$(this).val())$(this).val(i).css("color","#ccc")}),$("#pay-treat-card").val(r).css("color","#ccc"),$("#pay-treat-card").on("focus",function(){if($(this).val().indexOf(r.substr(0,2))>=0)$(this).val("").css("color","#000");else $(this).css("color","#000")}),$("#pay-treat-card").on("blur",function(){if(""==$(this).val())$(this).val(r).css("color","#ccc")})}();$("#insurance-card").on("blur",function(){g()}),$("#contact-address").on("blur",function(){v()}),$("#patient-id-card").on("blur",function(){x()}),$("#patient-id-card-password").on("blur",function(){w()}),$("#disease-name").on("blur",function(){C()}),$("#pay-insurance-card").on("blur",function(){y()}),$("#pay-treat-card").on("blur",function(){var e=$('input[name="treated"]');if(2==exports.isShowTreatedZyw)b(2);else if(e.eq(0).is(":checked"))b(1);else if(e.eq(1).is(":checked"))b(0);else b(-1)}),$("#disease-name").on("keyup",function(){var e=this.value;if(e.length>20)$(this).val(e.substr(0,20)).next().hide().next().show().find(".wrong-info").html("所填疾病名称不能超过20字")});T.addInputEventListener("#patient-id-card",function(){this.value}),$("#condition").on("blur",function(){k()}),
T.addInputEventListener("#condition",function(){T.txtrOverflow(this,300,$(this).parent().parent().find("p i"))}),$("#agreement").on("change",function(){}),$(".popwin-info .close-x").on("click",function(){$(".popwin-info").hide()}),$(".card-person-add").on("click",function(){$(".error-info").hide(),$(".popwin").show()}),$(".popwin .card-close").on("click",function(){$(".card-input input").val(""),$(".popwin").hide()}),$(".popwin .add_no").on("click",function(){$(".card-input input").val(""),$(".popwin").hide()}),$(".popwin .add_yes").on("click",function(){var t=$(".popwin input:eq(0)"),n=$(".popwin input:eq(1)");if(T.nameCheck(t[0])&&T.idCardCheck(n.val())){var i=require("common/js/ajax");i({url:""+e.api+"/pc/contacts/add",type:"POST",datatype:"json",async:!1,data:{name:$("#popwin-patient-name").val(),identification:$("#popwin-id-card").val()},success:function(e){if(0==e.status)$(".card-close").trigger("click"),a();else $(".error-info").show().html("<p>"+e.statusInfo+"</p>")},error:function(){$(".error-info").show().find("span").html("请求失败！")}})}else if($(".error-info").show(),""==t.val()&&""==n.val())$(".error-info").find("span").html("用户名和身份证号不能为空！");else if(""==t.val())$(".error-info").find("span").html("用户名不能为空！");else if(""==n.val())$(".error-info").find("span").html("身份证号不能为空！");else if(!T.nameCheck(t[0]))$(".error-info").find("span").html("用户名输入有误！");else $(".error-info").find("span").html("身份证号输入有误！")}),$(".popwin-edit .card-close").on("click",function(){$(".card-input input").val(""),$(".edit-errorInfo").hide(),$(".popwin-edit").hide(),$('.popwin-edit input[type="text"]').css("border-color","#d7d7d7")}),$(".popwin-edit .add_no").on("click",function(){$(".card-input input").val(""),$(".edit-errorInfo").hide(),$(".popwin-edit").hide(),$('.popwin-edit input[type="text"]').css("border-color","#d7d7d7")}),$("#edit-id-card").on("focus",function(){var e=this.value;if(18==e.length&&e.indexOf("*")>=0)this.value=""}),$(".popwin-edit .add_yes").on("click",function(){var t=$(".popwin-edit input:eq(0)"),n=$(".popwin-edit input:eq(1)"),i=$("#patient-list li").index($(".card-person-suc"));if(0>i)i=$("#patient-list li").index($(".card-nameId-err"));if($('.popwin-edit input[type="text"]').css("border-color","#d7d7d7"),t.val()==t.attr("data-default")&&n.val()==n.attr("data-default"))$(".edit-errorInfo").hide(),$(".card-close").trigger("click");else if(T.nameCheck(t[0])&&T.idCardCheck(n.val())){$(".edit-errorInfo").hide();var r=require("common/js/ajax");r({url:""+e.api+"/pc/contacts/edit",type:"POST",datatype:"json",async:!1,data:{id:exports.nowPatientList[i].id,name:t.val(),identification:n.val()},success:function(e){if(0==e.status)$(".card-close").trigger("click"),a();else $(".edit-errorInfo").show().find("span").html(e.statusInfo),$('.popwin-edit input[type="text"]').css("border-color","#e72e25")},error:function(){$(".edit-errorInfo").show().find("span").html("请求失败！"),$('.popwin-edit input[type="text"]').css("border-color","#e72e25")}})}else{$(".edit-errorInfo").show();var o=0;if(""==t.val()&&""==n.val())return $(".edit-errorInfo").find("span").html("请填写姓名和身份证号"),void $('.popwin-edit input[type="text"]').css("border-color","#e72e25");else if(""==t.val())$(".edit-errorInfo").find("span").html("请填写姓名");else if(""==n.val())$(".edit-errorInfo").find("span").html("请填写身份证号"),o=1;else if(!T.nameCheck(t[0]))$(".edit-errorInfo").find("span").html("用户名格式不正确，请重新填写");else $(".edit-errorInfo").find("span").html("身份证号格式不正确，请重新填写"),o=1;$('.popwin-edit input[type="text"]').eq(o).css("border-color","#e72e25")}})},exports.init=function(e){var i=require("order/sharingTimes");if($('input[type!="button"], textarea').val(""),$("#agreement").attr("checked",!0),f(),1==$(".top").data("login"))a();e&&o(e),!e&&i&&s(i,6),$("#submit-order").addClass("action");var r=0,l=function(){if(exports.submitFlag){exports.submitFlag=!1,setTimeout(function(){exports.submitFlag=!0,$("#submit-order").one("click",l)},1500);var e=require("common/js/loading"),i=new e({content:'<i class="fa fa-spinner" style="font-size:30px"></i>'});if(i.init(),!n())i.remove();else clearTimeout(r),r=setTimeout(function(){if(t(),0==exports.status)i.remove()},1e3)}};$("#submit-order").one("click",l)},exports});