/*! 2016 Baidu Inc. All Rights Reserved */
define("home/appointment",["require","common/js/ajax"],function(require){return{init:function(e){var t=this;t.areaInit(),t.addSelectEvent(e),t.addDepartEvent(),t.addBtnEvent()},api:function(){var e=$("#footer-three").data("api");return e}(),areaInit:function(){var e=this;$(".select-click").delegate("div","click",function(){$(".select-click").find("div").removeClass("current-area"),$(".select-click").find("ul").hide(),$("#hospital-list").hide(),$("#hospital-list").html(""),$(".department-list").hide(),$(".second-active").html(""),$(this).addClass("current-area"),$(this).find("ul").show();var e=$(this).attr("data-type");$(".select-click").find("ul").eq(e).show()}),$(".select-hospital").find("div").off("click").on("click",function(){if($("#hospital-list").css("border","1px solid rgba(0,0,0,0.1)"),!$("#hospital-list").is(":visible"))e.getHospiatlList(e.page);$(".department-list").hide(),$(".second-active").html("")}),$(".select-hospital").off("mouseleave").on("mouseleave",function(){$("#hospital-list")[0].scrollTop=0,$(".ajax-loading").hide(),$("#hospital-list").hide(),$("#hospital-list").html(""),e.page=1}),$(".select-depart").find("div").click(function(){if($(".department-list").css("border","1px solid rgba(0,0,0,0.1)"),!$(".department-list").is(":visible"))e.getDepartList(e.page)}),$(".select-depart").off("mouseleave").on("mouseleave",function(){if($(".second-active").length>0)$(".second-active")[0].scrollTop=0,$(".first-depart")[0].scrollTop=0,$(".department-list").hide(),$(".second-active").html("")})},clearHosDep:function(){var e=this;$("#hospital_id").html("请选择"),$("#hospital_id").css("color","#ccc"),$("#hospital_id").attr("title",""),$("#hospital_id").attr("data-id","0"),$("#hospital-list").html(""),e.clearDep()},clearDep:function(){$(".second-active").html(""),$("#depart-id").html("请选择"),$("#depart-id").css("color","#ccc"),$("#depart-id").attr("data-firstId",""),$("#depart-id").attr("data-secondId",""),$("#depart-id").attr("data-departmentflag","")},addSelectEvent:function(e){var t=this;$(".province-list").delegate("li","click",function(){t.selectCityArea(this,e,$(".pc-city-list")),$(this).parent().find("li").removeClass("cur-select"),$(this).addClass("cur-select"),t.clearHosDep(),t.page=1}),$(".pc-city-list").delegate("li","click",function(){for(var n,i=$(".select-click").find("div").eq(0).find("span").attr("data-id"),r=($(".select-click").find("div").eq(1).find("span").attr("data-id"),e.length),o=0;r>o;o++)if(i==e[o].id)n=e[o].children;t.selectCityArea(this,n,$(".region-list")),$(this).parent().find("li").removeClass("cur-select"),$(this).addClass("cur-select"),t.clearHosDep(),t.page=1}),$(".region-list").delegate("li","click",function(){$(".select-click").find(".area-info").eq(2).find("span").attr("data-id",$(this).attr("data-id")).attr("title",$(this).html()).html($(this).html()),$(".select-click").find(".area-info").removeClass("current-area"),$(this).parent("ul").hide(),$(this).parent().find("li").removeClass("cur-select"),$(this).addClass("cur-select"),t.clearHosDep(),t.page=1}),$(".select-click").mouseleave(function(){t.selectAreaClose(this)})},addHospitalEvent:function(){var e=this;$("#hospital-list").off("scroll").on("scroll",function(){if(0!=$("#hospital-list")[0].scrollTop)if(this.scrollHeight-$(this).height()-$(this).scrollTop()==0)if(e.page<=e.totalPage)e.getHospiatlList(e.page)}),$("#hospital-list").delegate("li","click",function(){if(""!=$(this).html())$("#hospital-list").find("li").removeClass("cur-select"),$(this).addClass("cur-select"),$("#hospital_id").css("color","#333"),$("#hospital_id").html($(this).html()),$("#hospital_id").attr("title",$(this).attr("data-value")),$("#hospital_id").attr("data-id",$(this).attr("data-id")),$("#hospital-list").hide(),$("#hospital-list").html(""),$("#hospital-list").css("border","none"),e.clearDep()})},addBtnEvent:function(){var e=this,t="";$(".btn-appointment").delegate("span","click",function(){var n=require("common/js/ajax"),i={key:$("#hospital_id").attr("title"),provId:$("#provId").attr("data-id"),cityId:$("#cityId").attr("data-id"),regionId:$("#regionId").attr("data-id"),hosId:$("#hospital_id").attr("data-id"),departLevel1Id:$("#depart-id").attr("data-firstid"),departLevel2Id:$("#depart-id").attr("data-secondid"),departmentFlag:$("#depart-id").attr("data-departmentflag")},r=$.extend(!0,{},e.hashData,i);if(n({url:""+e.api+"/pc/appointment/geturl",type:"GET",datatype:"jsonp",sync:!0,data:r,success:function(e){if(0==e.status)t=e.data.url;else;},error:function(){}}),""!=t)window.open(t,"_blank")})},addDepartEvent:function(){$(".first-depart").mouseenter(function(){$(this).children("li").removeClass("active-depart")}),$(".first-depart").delegate("li >.second-active >li","click",function(){$("#depart-id").html($(this).html()),$("#depart-id").css("color","#333"),$("#depart-id").attr("data-firstId",$(this).attr("data-firstId")),$("#depart-id").attr("data-secondId",$(this).attr("data-secondId")),$("#depart-id").attr("data-departmentflag",$(this).attr("data-departmentflag")),$(".department-list").hide(),$(".second-active").html("")})},selectCityArea:function(e,t,n){for(var i,r,o,a,s=$(e).attr("data-id"),l=t.length,c="",u=0;l>u;u++)if(s==t[u].id){var d=t[u].children.length;if(i=t[u].children[0].id,r=t[u].children[0].name,2==$(e).parent("ul").index())o=t[u].children[0].children[0].id,a=t[u].children[0].children[0].name;for(var f=0;d>f;f++)c+='<li data-id="'+t[u].children[f].id+'" title="'+t[u].children[f].name+'">'+t[u].children[f].name+"</li>"}if($(".current-area").find("span").html($(e).html()),$(".current-area").find("span").attr("data-id",s).attr("title",$(e).html()),$(".select-click").find(".area-info").removeClass("current-area"),$(e).parent("ul").hide(),n.html(""),n.append($(c).hover(function(){$(this).css({"background-color":"#2896f3",color:"#fff"})},function(){$(this).css({"background-color":"#fff",color:"#333"})})),2==$(e).parent("ul").index())$(".select-click").find(".area-info").eq(1).find("span").attr("data-id",i).attr("title",r).html(r),$(".select-click").find(".area-info").eq(2).find("span").attr("data-id",o).attr("title",a).html(a),$(".pc-city-list").find("li").eq(0).click(),$(".region-list").find("li").eq(0).click();else if(4==$(e).parent("ul").index())$(".select-click").find(".area-info").eq(2).find("span").attr("data-id",i).attr("title",r).html(r),$(".region-list").find("li").eq(0).click()},selectAreaClose:function(e){$(".select-click").find(".area-info").removeClass("current-area"),$(e).find("ul").hide()},getHospiatlList:function(e){$(".select-click").find(".area-info").removeClass("current-area"),$("#hospital-list").show();var t=this,n=require("common/js/ajax");if(t.page>1)$(".ajax-loading").show();var i={provId:$("#provId").attr("data-id"),cityId:$("#cityId").attr("data-id"),regionId:$("#regionId").attr("data-id"),page:t.page,pageSize:10},r=$.extend(!0,{},t.hashData,i);n({url:""+t.api+"/pc/hospital/listregion",type:"GET",data:r,success:function(e){if(t.page>1)$(".ajax-loading").hide();if(0==e.status)t.totalPage=e.data.totalPage,t.createHospiatlList(e.data.data),t.addHospitalEvent(),t.page++;else;},error:function(){}})},createHospiatlList:function(e){for(var t="",n=0;n<e.length;n++)t+='<li data-id="'+e[n].id+'" data-value="'+e[n].name+'" title="'+e[n].name+'">'+e[n].name+"</li>";if(1==self.page)$("#hospital-list").html("");$("#hospital-list").append($(t).hover(function(){$(this).css({"background-color":"#2896f3",color:"#fff"})},function(){$(this).css({"background-color":"#fff",color:"#333"})})),$("#hospital-list").show()},getDepartList:function(){var e=this,t=require("common/js/ajax"),n={hosId:$("#hospital_id").attr("data-id")},i=$.extend(!0,{},e.hashData,n);t({url:""+e.api+"/pc/hospital/department",type:"GET",datatype:"json",data:i,success:function(t){if(0==t.status)e.createDepartList(t.data,t.data[0].value);else $(".department-list").css("border","none")},error:function(){$(".department-list").css("border","none")}})},createDepartList:function(e,t){for(var n="",i=0;i<e.length;i++){if(0==i)n+='<li data-value="'+e[i].value+'" index="'+i+'"  class="active-depart">'+e[i].name+'<ul class="second-active">';else n+='<li data-value="'+e[i].value+'" index="'+i+'">'+e[i].name+'<ul class="second-active">';for(var r=0;r<e[i].children.length;r++)n+='<li title="'+e[i].children[r].name+'" data-departmentflag="'+e[i].departmentFlag+'" data-secondId="'+e[i].children[r].value+'" data-firstId="'+e[i].value+'">'+e[i].children[r].name+"</li>";n+="</ul></li>"}var o=$("<ul></ul>"),a=$(n);a.hover(function(){$(this).css({"border-right":"none","background-color":"#fff"}),o.css("display","none"),$(this).find("ul").css("display","block"),o=$(this).find("ul")},function(){$(this).css({"background-color":"#f5f5f5",color:"#333"})}),a.find("ul li").hover(function(){$(this).css({"background-color":"#2896f3",color:"#fff"})},function(){$(this).css({"background-color":"#fff",color:"#333"})}),$(".first-depart").html(""),$(".first-depart").append(a),$(".select-click").find(".area-info").removeClass("current-area"),$("#hospital-list").hide(),$("#hospital-list").html(""),$(".department-list").show()}}});